#### git安装

```
[11899517@bigdata4 ~]$ git clone https://github.com/azkaban/azkaban.git
正克隆到 'azkaban'...
remote: Enumerating objects: 29, done.
remote: Counting objects: 100% (29/29), done.
remote: Compressing objects: 100% (25/25), done.
remote: Total 34819 (delta 9), reused 4 (delta 4), pack-reused 34790
接收对象中: 100% (34819/34819), 49.19 MiB | 60.00 KiB/s, done.
处理 delta 中: 100% (19380/19380), done.
```

#### 修改配置

```
[11899517@bigdata4 ~]$ cd azkaban
[11899517@bigdata4 azkaban]$ vim build.gradle
```

<li>修改hadoop依赖version

```
ext.versions = [
        hadoop: '2.7.6',
        hive  : '1.1.0',
        pig   : '0.11.0',
        restli: '1.15.7',
        slf4j : '1.7.18',
]
```

<li>增加yarn相关依赖

```
//注意用双引号，${versions.hadoop}
        yarnapi             : "org.apache.hadoop:hadoop-yarn-api:${versions.hadoop}",
        yarncommon          : "org.apache.hadoop:hadoop-yarn-common:${versions.hadoop}",
        yarnclient          : "org.apache.hadoop:hadoop-yarn-client:${versions.hadoop}",
```

<li>在exec的build.gradle中增加的依赖

```
[11899517@bigdata4 azkaban]$ vim azkaban-exec-server/build.gradle
```

```
    compile deps.hadoopCommon
    compile deps.hadoopHdfs
    compile deps.yarnapi
    compile deps.yarncommon
    compile deps.yarnclient
```

#### 编译

```
[11899517@bigdata4 azkaban]$ ./gradlew build -x test
```

```
Starting a Gradle Daemon, 2 busy Daemons could not be reused, use --status for details
Parallel execution with configuration on demand is an incubating feature.
Download https://repo.maven.apache.org/maven2/org/codehaus/jackson/jackson-mapper-asl/1.8.8/jackson-mapper-asl-1.8.8.jar

......中间省略n行输出

BUILD SUCCESSFUL in 8m 19s
73 actionable tasks: 18 executed, 55 up-to-date
```

#### ant安装

```
[11899517@bigdata4 azkaban]$ wget http://mirrors.shu.edu.cn/apache//ant/binaries/apache-ant-1.9.13-bin.tar.gz
--2019-02-15 09:31:21--  http://mirrors.shu.edu.cn/apache//ant/binaries/apache-ant-1.9.13-bin.tar.gz
正在解析主机 mirrors.shu.edu.cn (mirrors.shu.edu.cn)... 202.121.199.235
正在连接 mirrors.shu.edu.cn (mirrors.shu.edu.cn)|202.121.199.235|:80... 已连接。
已发出 HTTP 请求，正在等待回应... 200 OK
长度：5829814 (5.6M) [application/x-gzip]
正在保存至: “apache-ant-1.9.13-bin.tar.gz”

100%[======================================>] 5,829,814   1.14MB/s 用时 5.0s   

2019-02-15 09:31:27 (1.12 MB/s) - 已保存 “apache-ant-1.9.13-bin.tar.gz” [5829814/5829814])

[11899517@bigdata4 azkaban]$ ls -l
总用量 5868
-rw-rw-r-- 1 11899517 11899517 5829814 7月  13 2018 apache-ant-1.9.13-bin.tar.gz
drwxrwxr-x 4 11899517 11899517    4096 2月  14 13:44 az-core
[11899517@bigdata4 azkaban]$ tar -zxvf apache-ant-1.9.13-bin.tar.gz
```

#### ant环境变量配置

```
[11899517@bigdata4 ~]$ vi ~/.bashrc

export ANT_HOME=/mnt/home/11899517/azkaban/apache-ant-1.9.13
export PATH=${ANT_HOME}/bin:$PATH

[11899517@bigdata4 ~]$ snt
-bash: snt: 未找到命令
[11899517@bigdata4 ~]$ source ~/.bashrc
[11899517@bigdata4 ~]$ ant
Buildfile: build.xml does not exist!
Build failed
[11899517@bigdata4 ~]$ ant -version
Apache Ant(TM) version 1.9.13 compiled on July 10 2018
[11899517@bigdata4 ~]$ 
```

### 插件plugins

#### azkaban-plugins的build.xml

```
[11899517@bigdata4 ~]$ cd azkaban-plugins
[11899517@bigdata4 azkaban-plugins]$ ls -l
总用量 84
-rw-rw-r-- 1 11899517 11899517    58 2月  16 12:42 build.properties
-rw-rw-r-- 1 11899517 11899517  5320 2月  16 12:42 build.xml
-rw-rw-r-- 1 11899517 11899517 30874 2月  16 12:42 eclipse-styles.xml
drwxrwxr-x 2 11899517 11899517  4096 2月  16 12:42 extlib
-rw-rw-r-- 1 11899517 11899517  3964 2月  16 12:42 INSTALL
-rw-rw-r-- 1 11899517 11899517 11358 2月  16 12:42 LICENSE
-rw-rw-r-- 1 11899517 11899517  2302 2月  16 12:42 NOTICE
drwxrwxr-x 7 11899517 11899517  4096 2月  16 12:42 plugins
-rw-rw-r-- 1 11899517 11899517   485 2月  16 12:42 README.md
drwxrwxr-x 2 11899517 11899517  4096 2月  16 12:42 test_lib
drwxrwxr-x 2 11899517 11899517  4096 2月  16 12:42 test_resource
[11899517@bigdata4 azkaban-plugins]$ vi build.xml
与视频文件差别大，未把viewer相关模块注释，如javaviewer/pigvisualizer/reportal
```

#### azkaban-plugins的build.xml

```
[11899517@bigdata4 ~]$ cd azkaban-plugins
[11899517@bigdata4 azkaban-plugins]$ ls -l
总用量 84
-rw-rw-r-- 1 11899517 11899517    58 2月  16 12:42 build.properties
-rw-rw-r-- 1 11899517 11899517  5320 2月  16 12:42 build.xml
-rw-rw-r-- 1 11899517 11899517 30874 2月  16 12:42 eclipse-styles.xml
drwxrwxr-x 2 11899517 11899517  4096 2月  16 12:42 extlib
-rw-rw-r-- 1 11899517 11899517  3964 2月  16 12:42 INSTALL
-rw-rw-r-- 1 11899517 11899517 11358 2月  16 12:42 LICENSE
-rw-rw-r-- 1 11899517 11899517  2302 2月  16 12:42 NOTICE
drwxrwxr-x 7 11899517 11899517  4096 2月  16 12:42 plugins
-rw-rw-r-- 1 11899517 11899517   485 2月  16 12:42 README.md
drwxrwxr-x 2 11899517 11899517  4096 2月  16 12:42 test_lib
drwxrwxr-x 2 11899517 11899517  4096 2月  16 12:42 test_resource
[11899517@bigdata4 azkaban-plugins]$ cd plugins
[11899517@bigdata4 plugins]$ ls -l
总用量 20
drwxrwxr-x 4 11899517 11899517 4096 2月  16 12:42 crypto
drwxrwxr-x 4 11899517 11899517 4096 2月  16 12:42 hadoopsecuritymanager
drwxrwxr-x 4 11899517 11899517 4096 2月  16 12:42 hadoopsecuritymanager-common
drwxrwxr-x 4 11899517 11899517 4096 2月  16 12:42 hadoopsecuritymanager-yarn
drwxrwxr-x 6 11899517 11899517 4096 2月  16 12:42 jobtype
[11899517@bigdata4 plugins]$ vi jobtype/build.xml
```

<li>把target的fail注释,去掉单元测试用例的失败进程
        
<li>给jobtype jar增加相应的jar包

```
                <copy file="${azkaban-jobtype-jar}" todir="${dist.packages.dir}/hadoopShell" />
                <copy file="${azkaban-jobtype-jar}" todir="${dist.packages.dir}/spark" />
```

<li>给hadoopsecuritymanager增加相应的jar包

```
                <copy file="${hadoopsecuritymanagerjar}" todir="${dist.packages.dir}/hadoopShell" />
                <copy file="${hadoopsecuritymanagerjar}" todir="${dist.packages.dir}/spark" />
```

#### ant编译

```
[11899517@bigdata4 plugins]$ cd ..
[11899517@bigdata4 azkaban-plugins]$ ls
build.properties  eclipse-styles.xml  INSTALL  NOTICE   README.md  test_resource
build.xml         extlib              LICENSE  plugins  test_lib
[11899517@bigdata4 azkaban-plugins]$ ant
Buildfile: /mnt/home/11899517/azkaban-plugins/build.xml

createDist:
    [mkdir] Created dir: /mnt/home/11899517/azkaban-plugins/dist
    中间省略很多输出
package:

package:
    [mkdir] Created dir: /mnt/home/11899517/azkaban-plugins/dist/packages
     [copy] Copying 82 files to /mnt/home/11899517/azkaban-plugins/dist/packages/jobtypes
      [tar] Building tar: /mnt/home/11899517/azkaban-plugins/dist/packages/azkaban-plugins-3.0.0.tar.gz

BUILD SUCCESSFUL
Total time: 17 seconds
```

<li>在packages目录看到打包后的结果:

```
[11899517@bigdata4 azkaban-plugins]$ ls
build.properties  dist                extlib   LICENSE  plugins    test_lib
build.xml         eclipse-styles.xml  INSTALL  NOTICE   README.md  test_resource
[11899517@bigdata4 azkaban-plugins]$ cd dist
[11899517@bigdata4 dist]$ ls
crypto  hadoopsecuritymanager  hadoopsecuritymanager-yarn  jobtype  packages  package.version
[11899517@bigdata4 dist]$ cd jobtype
[11899517@bigdata4 jobtype]$ ls
classes  jars  packages  testclasses
[11899517@bigdata4 jobtype]$ cd packages
[11899517@bigdata4 packages]$ ls
azkaban-hadoopsecuritymanageryarn-3.0.0.jar  hadoopJava      package.version  pig-0.9.2
azkaban-jobtype-3.0.0.tar.gz                 hadoopShell     pig-0.10.0       spark
commonprivate.properties                     hdfsToTeradata  pig-0.10.1       teradataToHdfs
common.properties                            hive            pig-0.11.0
gobblin   
```

#### 数据库建表

```
[11899517@bigdata4 ~]$ mysql -hlocalhost -P3306 -uroot -pGg/ru,.#5
mysql: [Warning] Using a password on the command line interface can be insecure.
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 18857
Server version: 5.7.22 MySQL Community Server (GPL)

Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> CREATE DATABASE azkabanqly;
Query OK, 1 row affected (0.00 sec)

mysql> show tables;
ERROR 1046 (3D000): No database selected
mysql> exit
Bye
[11899517@bigdata4 ~]$ 
```

<li>获取创建数据库表的语句

```
[11899517@bigdata4 azkaban]$ cd ..
[11899517@bigdata4 ~]$ ls
000000_0         indata.txt
17monipdb.dat    json-serde-1.3.6-jar-with-dependencies.jar
all_tar          log0605-output
azkaban          log0605.txt
azkaban-plugins  metastore_db
derby.log        mysql-connector-java-5.1.46.jar
flume            mysql-connector-java-5.1.47.jar
flumefile        part00000
flume_log        soft
hive             sqoop
hivefile
[11899517@bigdata4 ~]$ cd azkaban-plugins
[11899517@bigdata4 azkaban-plugins]$ cd ..
[11899517@bigdata4 ~]$ cd azkaban
[11899517@bigdata4 azkaban]$ cd azkaban-db
[11899517@bigdata4 azkaban-db]$ cd build
[11899517@bigdata4 build]$ ls
classes  distributions  libs  sql  tmp
[11899517@bigdata4 build]$ cd distribution
-bash: cd: distribution: 没有那个文件或目录
[11899517@bigdata4 build]$ cd distributions
[11899517@bigdata4 distributions]$ ls
azkaban-db-3.69.0-7-g3e5693a.tar.gz  azkaban-db-3.69.0-7-g3e5693a.zip
[11899517@bigdata4 distributions]$ tar -zxvf azkaban-db-3.69.0-7-g3e5693a.tar.gz
azkaban-db-3.69.0-7-g3e5693a/
中间省略很多输出
azkaban-db-3.69.0-7-g3e5693a/create-all-sql-3.69.0-7-g3e5693a.sql
[11899517@bigdata4 distributions]$ ls
azkaban-db-3.69.0-7-g3e5693a         azkaban-db-3.69.0-7-g3e5693a.zip
azkaban-db-3.69.0-7-g3e5693a.tar.gz
[11899517@bigdata4 distributions]$ 
```

<li>执行建表语句
        
```
[11899517@bigdata4 azkaban-db-3.69.0-7-g3e5693a]$ mysql -hlocalhost -P3306 -uroot -pGg/ru,.#5 -Dazkabanqly < create-all-sql-3.69.0-7-g3e5693a.sql
mysql: [Warning] Using a password on the command line interface can be insecure.
[11899517@bigdata4 azkaban-db-3.69.0-7-g3e5693a]$ mysql -hlocalhost -P3306 -uroot -pGg/ru,.#5 -Dazkabanqly
mysql: [Warning] Using a password on the command line interface can be insecure.
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 22322
Server version: 5.7.22 MySQL Community Server (GPL)

Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> show tables;
+--------------------------+
| Tables_in_azkabanqly     |
+--------------------------+
| QRTZ_BLOB_TRIGGERS       |
| QRTZ_CALENDARS           |
| QRTZ_CRON_TRIGGERS       |
| QRTZ_FIRED_TRIGGERS      |
| QRTZ_JOB_DETAILS         |
| QRTZ_LOCKS               |
| QRTZ_PAUSED_TRIGGER_GRPS |
| QRTZ_SCHEDULER_STATE     |
| QRTZ_SIMPLE_TRIGGERS     |
| QRTZ_SIMPROP_TRIGGERS    |
| QRTZ_TRIGGERS            |
| active_executing_flows   |
| active_sla               |
| execution_dependencies   |
| execution_flows          |
| execution_jobs           |
| execution_logs           |
| executor_events          |
| executors                |
| project_events           |
| project_files            |
| project_flow_files       |
| project_flows            |
| project_permissions      |
| project_properties       |
| project_versions         |
| projects                 |
| properties               |
| triggers                 |
+--------------------------+
29 rows in set (0.00 sec)

mysql> 
```

#### 部署web

```

```


#### 部署exec

```

```









